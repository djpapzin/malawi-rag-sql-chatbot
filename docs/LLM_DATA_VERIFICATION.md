# LLM Data Verification Report

This document details the verification of data returned by the LLM against the actual database contents. The purpose is to identify discrepancies and understand the limitations of the LLM's responses.

## Verification Process

We used custom-built verification tools to compare LLM responses with the actual database:

1. **verify_data.py**: Queries the database directly to get accurate statistics
2. **inspect_sql_queries.py**: Examines the SQL generated by LangChain for natural language queries

## Key Findings

### 1. Health Sector Projects

#### Database Reality:
- **Project Count**: 219 health sector projects
- **Total Budget**: MWK 53,044,625,236.90
- **Top Project**: "Maintanance of dispensary, construction of one staff house..." with budget of MWK 35,577,086,000.00

#### LLM Response:
- **Project Count**: 43 or 54 projects (varies between responses)
- **Total Budget**: ~MWK 13-14 billion (significantly lower than actual)
- **Examples Cited**: Projects with incorrect budget figures

#### SQL Analysis:
The SQL query generated by the LLM for counting health projects was:
```sql
SELECT COALESCE(COUNT(*), 0) as num_projects 
FROM proj_dashboard 
WHERE LOWER(projectsector) LIKE '%health%';
```

This query is actually correct and would return 219, but the LLM seems to be incorporating other filtering or making calculation errors.

### 2. Project Budget Discrepancies

#### Database Reality:
- "Construction of a Maternity Block and 1no. Staff house at Liwera Health Centre"
  - **Actual Budget**: MWK 195,000,000.00

- "Construction of a Maternity Block and 1no. Staff house at Beni Health Centre"
  - **Actual Budget**: MWK 195,000,000.00

- "Completion of Chinkombero maternity wing and dispensary"
  - **Actual Budget**: MWK 120,000,000.00

#### LLM Response:
- "Construction of a Maternity Block and 1no. Staff house at Liwera Health Centre"
  - **Reported Budget**: MWK 1,950,000,000.00 (10x larger)

- "Construction of a Maternity Block and 1no. Staff house at Beni Health Centre"
  - **Reported Budget**: MWK 1,950,000,000.00 (10x larger)

- "Completion of Chinkombero maternity wing and dispensary"
  - **Reported Budget**: MWK 1,200,000,000.00 (10x larger)

#### Analysis:
The LLM consistently reports budget figures that are 10 times higher than the actual database values. This suggests a systematic error in the LLM's handling of financial data.

### 3. Projects by District

The database shows Lilongwe has 89 projects, which matches what was reported previously.

## Root Causes of Discrepancies

Based on our analysis, the discrepancies appear to stem from:

1. **Limited Database Understanding**: The LLM may not have a complete understanding of the database schema or content.

2. **Inconsistent Data Handling**: The LLM seems to apply inconsistent filtering or calculations when analyzing numerical data.

3. **Numeric Precision Issues**: The LLM consistently makes order-of-magnitude errors with budget figures, suggesting issues with numeric precision.

4. **Generative Tendencies**: The LLM may occasionally fabricate data when it's uncertain, rather than acknowledging limitations.

## Recommendations

1. **Always Verify Critical Data**: For financial figures or other critical data, always verify LLM responses against direct database queries.

2. **Use the Verification Tools**: Utilize the provided tools to check data accuracy:
   ```bash
   python scripts/verify_data.py sector health
   python scripts/inspect_sql_queries.py compare budget health
   ```

3. **Apply Budget Corrections**: Use the budget correction tool to automatically fix magnitude errors in LLM responses:
   ```bash
   python scripts/fix_llm_budget.py llm_response.txt -o corrected_response.txt
   ```
   This tool will:
   - Correct known project budgets to their verified values
   - Fix magnitude errors (e.g., when budgets are reported 10x larger than actual)
   - Highlight all corrections made to the text

4. **Consider LLM Response Constraints**: Add constraints to the LLM prompt to require citation of sources or explicit SQL queries.

5. **Implement Automated Validation**: For production use, implement automated validation of LLM responses against direct database queries for critical metrics.

## Conclusion

While the LLM provides a convenient natural language interface to the database, it should not be considered an authoritative source for precise numerical data. Direct database queries should be used when accuracy is critical.

This validation process has highlighted the specific limitations of the current implementation and provides a framework for ongoing improvement and validation. 